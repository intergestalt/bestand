FROM node:12 as builder

# set working directory
RUN mkdir /app
WORKDIR /app

ENV PATH /app/node_modules/.bin:$PATH

ADD package.json yarn.lock /app/
RUN yarn --pure-lockfile
RUN mkdir ./public && tar cpf ./public/node_modules.tar node_modules

FROM mhart/alpine-node:12

COPY --from=builder /app/public /public

WORKDIR /public
RUN yarn global add serve

EXPOSE 8000

ENTRYPOINT [ "serve", "-p", "8000" ]
